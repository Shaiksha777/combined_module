    
<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Automated Skill Assessment Portal</title>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    body {
      background: linear-gradient(135deg, #0d0d0d, #1a1a1a);
      color: #fff;
      font-family: 'Segoe UI', sans-serif;
    }

    .navbar {
      background: rgba(255, 255, 255, 0.05);
      backdrop-filter: blur(10px);
      box-shadow: 0 4px 30px rgba(0,0,0,0.1);
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }

    .navbar-brand { font-weight: bold; font-size:1.6rem; color:#00e0ff!important; }
    .nav-link { color:#ccc!important; margin:0 10px; transition:color .3s; }
    .nav-link:hover { color:#00e0ff!important; }

    .hero {
      text-align:center;
      padding:100px 20px 40px;
    }
    .hero h1 { font-size:3rem; font-weight:800; }

    .stepper {
      display:flex;
      justify-content:center;
      align-items:center;
      margin:40px 0;
    }
    .step {
      position:relative;
      text-align:center;
      flex:1;
    }
    .step:not(:last-child)::after {
      content:''; position:absolute; top:12px; right:-50%;
      width:100%; height:4px;
      background:#444; z-index:0;
    }
    .step-circle {
      width:28px; height:28px; border-radius:50%;
      background:#222; margin:auto; line-height:28px;
      color:#aaa; font-weight:600;
      position:relative; z-index:1;
      transition:background .3s,color .3s;
    }
    .step-label { margin-top:8px; font-size:.9rem; color:#aaa; }
    .step.active .step-circle {
      background:linear-gradient(90deg,#00e0ff,#8a2be2);
      color:#fff;
    }
    .step.completed .step-circle {
      background:linear-gradient(90deg,#00e676,#00e0ff);
      color:#fff;
    }

    .dropzone {
      position:relative;
      border:2px dashed #555;
      border-radius:12px;
      padding:40px;
      text-align:center;
      background:rgba(255,255,255,0.02);
      transition:border-color .3s,background .3s;
      cursor: pointer;
    }
    .dropzone.dragover { border-color:#00e0ff; background:rgba(0,224,255,0.05); }
    .dropzone input[type="file"] {
      position:absolute;
      top:0; left:0; width:100%; height:100%;
      opacity:0; cursor:pointer;
    }
    .dz-icon { font-size:2.5rem; color:#00e0ff; margin-bottom:12px; }
    .dz-text { color:#ccc; font-size:1.1rem; }
    .filename-preview { font-size:0.9rem; color:#88f; margin-top:10px; }

    .status-message {
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      gap: 10px;
      color: #00e676;
      font-weight: 600;
      text-align: center;
      margin: 30px 0;
    }

    .btn-primary {
      background:linear-gradient(135deg,#00e0ff,#3a47d5);
      border:none;
    }

    footer {
      margin-top: 80px;
      padding: 20px 0;
      background: #111;
      text-align: center;
      color: #666;
      font-size: 0.9rem;
      border-top: 1px solid #333;
    }

        /* Overlay style */
    .overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: linear-gradient(135deg, #0d0d0d, #1a1a1a); /* Dark full-screen background */
      display: none;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      z-index: 9999;
      color: #00e0ff;
      font-family: 'Segoe UI', sans-serif;
    }

    /* Enhanced Loader Spinner */
    .loader {
      width: 60px;
      aspect-ratio: 1;
      color: #00e0ff;
      background: conic-gradient(currentColor 0 270deg, #0000 0);
      border-radius: 50%;
      animation: l14-0 4s infinite linear;
      filter: drop-shadow(0 0 10px #00e0ff90); /* soft glow */
    }

    .loader::before {
      content: "";
      display: block;
      height: 50%;
      width: 50%;
      border-top-left-radius: 100px;
      background: currentColor;
      animation: l14 0.5s infinite alternate;
    }

    @keyframes l14-0 {
      0%,24.99%  {transform: rotate(0deg)}
      25%,49.99% {transform: rotate(90deg)}
      50%,74.99% {transform: rotate(180deg)}
      75%,100%   {transform: rotate(270deg)}
    }

    @keyframes l14 {
      100%  {transform: translate(-10px,-10px)}
    }

    .overlay h4 {
      margin-top: 20px;
      font-size: 1.2rem;
      font-weight: 500;
      color: #ccc;
      text-shadow: 0 0 5px rgba(0, 224, 255, 0.3);
    }
  </style>
</head>
<body>

<!-- ‚úÖ Loading Overlay -->
<!-- Loading Overlay -->
<div class="overlay" id="loadingOverlay">
  <div class="loader"></div>
  <h4>Sending emails... Please wait</h4>
</div>

<nav class="navbar navbar-expand-lg fixed-top">
  <div class="container-fluid px-4">
    <a class="navbar-brand" href="#">SkillAssess</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navMenu">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navMenu">
      <ul class="navbar-nav ms-auto">
        <li class="nav-item"><a class="nav-link" href="/start_server">Start Server</a></li>
        <li class="nav-item"><a class="nav-link" href="#">Reports</a></li>
        <li class="nav-item"><a class="nav-link" href="#">Settings</a></li>
      </ul>
    </div>
  </div>
</nav>

<header class="hero mt-5 pt-5">
  <h1>Automated Skill Assessment</h1>
  <p class="lead">Upload CSV files, assign questions, and notify students seamlessly</p>
</header>

<section class="container">
  <div class="stepper">
    <div class="step {% if questions_uploaded and emails_uploaded %}completed{% elif not questions_uploaded %}active{% endif %}">
      <div class="step-circle">1</div>
      <div class="step-label">Questions</div>
    </div>
    <div class="step {% if questions_uploaded and emails_uploaded %}completed{% elif questions_uploaded and not emails_uploaded %}active{% endif %}">
      <div class="step-circle">2</div>
      <div class="step-label">Emails</div>
    </div>
    <div class="step {% if questions_uploaded and emails_uploaded %}active{% endif %}">
      <div class="step-circle">3</div>
      <div class="step-label">Submit</div>
    </div>
  </div>

  {% if questions_uploaded %}
    <div class="status-message">
      ‚úÖ Questions uploaded successfully
    </div>
  {% else %}
    <form action="/upload_questions" method="post" enctype="multipart/form-data" class="dropzone">
      <div class="dz-icon">üìÅ</div>
      <div class="dz-text">Click or drag to upload Questions CSV</div>
      <input type="file" name="questions_file" accept=".csv" required onchange="previewFileName(this, 'qname'); this.form.submit();">
      <div class="filename-preview" id="qname"></div>
    </form>
  {% endif %}

  {% if questions_uploaded %}
    {% if emails_uploaded %}
      <div class="status-message">
        ‚úÖ Emails uploaded successfully
      </div>
    {% else %}
      <form action="/upload_emails" method="post" enctype="multipart/form-data" class="dropzone mt-4">
        <div class="dz-icon">‚úâÔ∏è</div>
        <div class="dz-text">Click or drag to upload Emails CSV</div>
        <input type="file" name="emails_file" accept=".csv" required onchange="previewFileName(this, 'ename'); this.form.submit();">
        <div class="filename-preview" id="ename"></div>
      </form>
    {% endif %}
  {% endif %}

  {% if questions_uploaded and emails_uploaded %}
    <div class="text-center mt-4">
      <button class="btn btn-primary btn-lg px-5 py-2" onclick="assignAndSend()">Assign & Send Mails</button>
    </div>
  {% endif %}

  {% if error %}
  <div class="alert alert-danger" style="color: red; font-weight: bold; margin-top: 10px;">
    ‚ùå Invalid file. Please check the format.
  </div>
  {% endif %}
</section>

<footer>
  &copy; 2025 SkillAssess. All rights reserved.
</footer>

<script>
  // Dropzone behavior
  document.querySelectorAll('.dropzone').forEach(zone => {
    ['dragenter', 'dragover'].forEach(evt => zone.addEventListener(evt, e => {
      e.preventDefault(); zone.classList.add('dragover');
    }));
    ['dragleave', 'drop'].forEach(evt => zone.addEventListener(evt, e => {
      e.preventDefault(); zone.classList.remove('dragover');
    }));
    zone.addEventListener('drop', e => {
      const input = zone.querySelector('input[type="file"]');
      const dt = new DataTransfer();
      dt.items.add(e.dataTransfer.files[0]);
      input.files = dt.files;
      previewFileName(input, input.name === 'questions_file' ? 'qname' : 'ename');
      input.form.submit();
    });
  });

  function previewFileName(input, targetId) {
    const label = document.getElementById(targetId);
    if (input.files.length > 0) {
      label.textContent = `Selected: ${input.files[0].name}`;
    } else {
      label.textContent = '';
    }
  }

  // ‚úÖ Assign and Send AJAX with Loader
  function assignAndSend() {
  // ‚úÖ Show loader
  document.getElementById('loadingOverlay').style.display = 'flex';

  fetch('/assign_questions')
    .then(response => response.text())
    .then(data => {
      // ‚úÖ Hide loader AFTER response is received
      document.getElementById('loadingOverlay').style.display = 'none';

      // Display the response (or redirect if needed)
      document.open();
      document.write(data);
      document.close();
    })
    .catch(error => {
      console.error('Error:', error);
      alert('Something went wrong!');
      document.getElementById('loadingOverlay').style.display = 'none';
    });
}

</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
